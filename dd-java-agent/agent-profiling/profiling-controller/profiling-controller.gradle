// Set properties before any plugins get loaded
ext {
  minJavaVersionForTests = JavaVersion.VERSION_11
}

apply from: "${rootDir}/gradle/java.gradle"
apply plugin: 'idea'

dependencies {
  compile deps.slf4j
  compile project(':dd-trace-api')

  testCompile deps.junit
}

sourceCompatibility = JavaVersion.VERSION_11
targetCompatibility = JavaVersion.VERSION_11

[JavaCompile, GroovyCompile].each {
  tasks.withType(it) {
    doFirst {
      // FIXME: `-processing` should be removed at some point - but it looks like linter gets confused by presence of lombok processor
      // FIXME: '-path' is used because groovy seems to confuse linter
      options.compilerArgs.addAll(['--release', '11', '-Xlint:all,-processing,-path', '-Werror'])
      options.fork = true
      options.forkOptions.javaHome = file(System.env.JAVA_11_HOME)
    }
  }
}

// Disable checkstyle since it doesn't want to check classes compiled with java (11) newer than gradle is running on (8)
tasks.withType(Checkstyle) { task ->
  enabled = false
}
